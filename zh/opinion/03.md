# 排查数据异常/数据波动问题，该如何下手？

在我做开发的这些年，让我很头痛的一类问题，不是线上故障，而是数据异常，不知道有没有程序员跟我感同身受。
大多数的服务故障都有较为直观的异常日志、结合产品表象，相对排查起来还有迹可循，但是数据异常的原因就太多了，很多时候连报错日志都没有，排查起来简直无从下手。

在一个微服务、分布式、前后端分离等概念热火朝天的年代，虽然给身为程序员的我们带来了很大便利，但也同时带来了很多苦恼。分工更加明确，减少了很多工作量，我们大部分的时间和精力都专注于自己所负责的模块。
本来一切都很美好，但是在排查一些数据异常类问题时却遇到了麻烦。产品的底层逻辑错综复杂，一个接口的响应需要经过三四个微服务的协同处理这非常正常，甚至涉及七八个微服务都不罕见。
不少服务是不同的人员，甚至是不同部门的人员在维护，这种情况下该如何快速定位问题呢？

如果自身服务有异常日志，一眼能就确认问题那还好说，如果自身服务一切正常，那排查起来可得费老大劲了。

这种数据异常问题，往往是突然就发生，打你一个措手不及，很多时候我们本来就有正常的开发排期，时间也比较紧张，突然再穿插一个数据异常排查的事情进来，这就很让我们苦恼。
当被产品经理或者部门主管找上门来，总不能跟他说：我的服务没问题，哪里的问题我也不知道！

这种情况下，既然是数据异常类的问题，不少朋友可能会说，还能咋办，要么跑数要么跑路！
不开玩笑，回到正题，这种问题虽然让我们头疼，但是得认真对待，因为以我的经验来看，稍一疏忽说不定还得替人背锅。

跑数，说起来简单做起来可不容易，我猜测大概分为这么几种情况：

（1）、已经将相关日志格式化后存储到数据平台，可以写SQL查询，困难指数：两颗星；
 (2)、日志没有格式化，需要写专门的Java或MR或Spark等的任务去解析日志然后再跑数，如果日志量大一点、日志格式再混乱一点，工作量可不小，困难指数：五颗星。
（3）、可能连必要日志都忘了打印，困难指数：非人力所能及，兄弟，跑路吧！

说到这，有些小伙伴觉得：明白了，知道怎么办了，把日志格式化都写到数据中台里，有问题就写SQL查！！！
我想说的是：too young,too simple！

在数据中台写SQL查询格式化后的日志，困难指数是两颗星，但问题是，这有个前提：得先把日志格式化后写到中台里，我认为这步操作的困难指数是：四颗星。
大多数企业自建或购买的第三方数据中台的实现方案一般是OLAP类的解决方案，当然有些企业比较有钱，喜欢用ES来搞，
而日志是非结构化的数据，各种事件类型的日志参数可能截然不同，要将日志写入到数据中台一般来说需要权衡：写入和查询的复杂度。
以很多json格式的数据将日志写入到中台，虽然方便写入，但查询起来困难。
将日志中的关键字段都提取出来然后写入到中台，虽然查询很简单，但写入很困难，因为你可能要创建N多个数据表来存储。

一般大一点企业在此类问题上的解决方案都是第一种和第二种方案结合：将较为关键的日志格式化写入数据中台，大部分时候写SQL，有时候遇到没有格式化日志的情况就只能开发程序跑原始日志了。

以上的方案，是目前的业内的现状，虽然基本上可以解决问题，但是总体来说还是比较麻烦的，此外企业层面还要承担很多日志数据的存储、维护以及相关统计分析计算的成本。

你以为今天的文章到此就结束了吗，没有，准确来说还没开始呢！

那还有没有其他更好技术方案了？

有，这就是我接下来要郑重的向大家推荐的技术方案：开源通用型流式大数据统计系统XL-LightHouse。

我用一句话来评价它在排查数据异常类问题的使用体验，那就是：简单、简单、你未曾体验过的简单！


























简单，简单，你未曾体验过的简单！


















