# Java API调用说明

## SDK引用

+ 1、系统提供Java版本SDK，在调用API前，请参考[业务接入-引用SDK](/management/04.md)的方式，在项目中引用Jar包。
+ 2、如果您对API使用安全性有更高要求，可以在本SDK的基础上额外增加数据加密或签名验证等处理流程。

## 调用示例

----

**完整调用示例，您可以参考项目源码：com.dtstep.lighthouse.core.test.api.DataQueryTest中的单元测试方法，修改相应参数（xl-lighthouse注册中心服务地址，统计项id、统计组秘钥、查询维度、时间参数等）即可直接运行！**

**如有问题，请随时联系开发者~**

----

```
/**
     * 对应API：LightHouse.dataQuery(int statId, String secretKey, String dimensValue, long startTime, long endTime)
     * @throws Exception
     *
     * 通过维度查询在指定时间范围内的统计结果
     *
     * 1、对于没有统计维度的统计项，示例：<stat-item title="每分钟_订单金额统计" stat="sum(amount)"/> dimensValue参数传Null；
     * 2、对于单维度的统计项，示例：<stat-item title="每分钟_各省份_订单金额统计" stat="sum(amount)" dimens="province"/> dimensValue参数传province字段对应的某个具体纬度值，如：山东或北京；
     * 3、对于多维度的统计项，示例：<stat-item title="每分钟_各业务线_各省份_订单金额统计" stat="sum(amount)" dimens="biz;province"/> dimensValue参数传biz字段和province字段对应的数值，并使用分号分割，如：家电;山东 或 手机;上海
     */
    @Test
    public void dataQueryTest() throws Exception {
        //LightHouse.init("10.206.6.11:4061,10.206.6.12:4061");//集群模式初始化
        LightHouse.init("10.206.6.26:4061");//单机模式初始化
        int statId = 1100594;
        String secretKey = "Kq2Ts5PCBBqTqCFfKtbHekcQObDOZDQMVNuN6Ej5";
        String dimensValue = null;
        long t = System.currentTimeMillis();
        long startTime = DateUtil.getDayStartTime(t);
        long endTime = DateUtil.getDayEndTime(t);
        //statId为对应统计项ID，secretKey为统计项所在统计组的秘钥，dimensValue为纬度值，startTime和endTime为查询起止时间范围
        List<StatValue> statValues = LightHouse.dataQuery(statId,secretKey,dimensValue,startTime,endTime);
        for (StatValue statValue : statValues) {
            //返回结果：batchTime为对应批次时间，dimensValue为相应纬度值，value为统计结果,statesValue如果统计项中包含多个统计函数，则按按顺序返回每一个统计函数的结果
            System.out.println("batchTime:" + statValue.getDisplayBatchTime() + ",dimensValue:" + statValue.getDimensValue() + ",value:" + statValue.getValue()
                    + ",statesValue:" + JsonUtil.toJSONString(statValue.getStatesValue()));
        }
        System.out.println("ok!");
    }
```

## 对外RPC接口说明

###  Lighthouse.init(String locators)

参数：locators，lighthouse远程RPC服务注册中心配置信息

作用：用于RPC服务初始化。

###  LightHouse.queryGroupInfo(String token)

参数：token，统计组标识

作用：用于判断统计组是否存在和校验统计组秘钥信息。


###  LightHouse.queryStatInfo(int statId)

参数：statId，统计项id

作用：用于判断统计项是否存在和校验统计项秘钥信息。

### LightHouse.stat(String token,final String secretKey,Map<String,Object> paramMap,long timestamp)

参数： token，统计组标识；secretKey，统计组秘钥；paramMap，原始消息参数信息；timestamp，消息事件时间戳；

作用：用于上报统计原始消息信息。

### LightHouse.stat(String token,final String secretKey,Map<String,Object> paramMap,int repeat, long timestamp)

参数： token，统计组标识；secretKey，统计组秘钥；paramMap，原始消息参数信息；repeat，统计消息重复上报次数，默认为1，timestamp，消息事件时间戳；

作用：用于上报统计原始消息信息。
