本文介绍如何对已部署的xl-lighthouse服务进行版本升级。系统中部署和升级需要使用root账号，其他操作如启动、停止、重启、日志导出、数据备份等日常运维操作均使用部署账号（默认为：work）。

## 备份原数据

在系统升级前请首先进行数据备份，参考章节：[数据备份与恢复](/docs/110049/)。

## 编译升级包

+ 下载源代码，指定所要升级到的目标版本号

```
git clone -b releases-x.x.x https://github.com/xl-xueling/xl-lighthouse.git
或 
git clone -b releases-x.x.x https://gitee.com/xl-xueling/xl-lighthouse.git
```

+ 源码编译

```
mvn clean install -P release
```
以下输出文件为对应版本的升级包
./lighthouse-upgrade/target/lighthouse-upgrade-x.x.x.tar.gz


## 系统升级

1、注意事项

+ 执行升级操作前，请首先执行stop-all.sh将集群停止；
+ 系统升级需要使用root账号；
+ 升级包上传路径不能在LDP_HOME路径下；

2、升级包放置路径

使用root账号登录系统，上传升级包。以下示例部署路径LDP_HOME为/opt/soft/lighthouse-2.1.2，我将升级包上传至/opt/soft/upgrade目录下。


```
正确路径示例：部署路径 /opt/soft/lighthouse-2.1.2  升级包放置路径：/opt/soft/upgrade
错误路径示例：部署路径 /opt/soft/lighthouse-2.1.2  升级包放置路径：/opt/soft/lighthouse-2.1.2/upgrade  （升级包不能放到部署路径下面，否则升级时会出现问题）
```

3、执行升级操作

```
# 解压升级包
tar zxvf lighthouse-upgrade-x.x.x.tar.gz

# 进入到lighthouse-upgrade-x.x.x目录下，然后执行升级脚本
./upgrade.sh
```

升级命令执行完成后，系统自动重启！

## 如果使用公网IP访问

如果您是使用公网IP访问，出现远程连接异常时，可以配置一下安装目录./light-webapps/build/config.json中的REACT_APP_BASE_URL参数的IP地址，将其修改为web服务的公网IP（系统升级后该配置文件会被重置），同时确保您的服务器已对公网放开9089端口(后端接口服务)和8181端口(Web服务)！

修改config.json中的ip地址为您的公网ip,注意端口号不要修改，9089是后端接口服务的端口
```
{
    "REACT_APP_BASE_URL":"http://10.206.6.31:9089",
    "AXIOS_TIMEOUT":60000
}
```

Web系统访问地址如下，端口号为8181
```
http://10.206.0.31:8181
```
