## 内置筛选组件

统计项创建完成后，依据统计项配置的维度字段生成内置筛选组件，随着原始消息的接入，系统自动存储维度字段的数值并展示到默认筛选组件中。

对于纬度值非常多的维度字段，在内置筛选组件中最多展示1000条纬度值数据，对于没有展示的纬度值，统计计算依然正常运行，不影响统计结果，可以通过自定义筛选组件或输入框筛选组件的方式来查询相应数据。

### 内置筛选组件分类

系统内置筛选组件分为两种：

+ 多选下拉框
+ 文本输入框

在统计项页面默认使用多选下拉框，工程管理员可以在统计项视图页面，点击“筛选组件配置图标”进行修改。

### 清理纬度值

如果需要清理内置筛选组件中的展示值，统计工程管理员可以在“工程管理” -> 选择相应统计组 -> 点击"更多"按钮 -> 点击"清理纬度值"菜单项，打开清理纬度值对话框。

清理纬度值操作不会影响统计结果，只影响内置筛选组件中的展示逻辑。

清理纬度值的方式分为两种：

+ 键值清理

键值清理是单个纬度值的清理方式，适合删除少量维度值信息。

在“键值清理”选项卡，选择相应维度字段，查找要清理的纬度值，然后点击删除按钮即可。

+ 批量清理

批量清理是完全删除当前统计组所有维度字段的数据，适合大批量删除历史纬度值信息的场景。删除操作不会影响这些维度的统计结果，随着原始消息的后续接入，维度字段会重新显示到筛选组件中。删除操作以前的统计结果均可正常展示。

在“批量清理”选项卡，点击“全部删除”按钮即可。

## 自定义筛选组件

默认筛选组件可以满足大部分业务场景，但在个别业务场景中可能需要对筛选组件进行定制，这时就可以使用自定义筛选组件。

相比于默认组件，自定义筛选的主要用途：

+ 对于一些字典类的维度字段，比如：地区（省、市、县），汽车领域的品牌、车型，资讯业务的帖子一级分类、二级分类，招聘业务的行业、一级职位、二级职位等等，很多时候原始消息中上报的往往是id，但在查询指标时使用id非常不直观，而这些字典类数据相对较为固定，这种情况下就可以使用自定义筛选组件实现id和label值的映射功能，并且一些常用筛选组件可以在企业内部共用，由专人维护即可。

+ 有些场景下可能有级联查询的需求，比如地区查询（省、市、县）、汽车领域的品牌、车型、资讯业务的帖子一级分类、二级分类，而默认筛选组件生成逻辑都不能支持这种情况，这种情况就可以使用自定义组件。

+ （后续扩展功能）自定义筛选组件将支持远程搜索可以动态获取业务方自己筛选信息，这种交互方式的好处：一是能够与业务方自己的数据保持实时一直，便于维护，二是便于业务方进行扩展内容显示，比如监控告警系统通过ip搜索相应节点，并展示节点的机房位置等扩展信息。


### 创建自定义筛选组件

点击系统菜单“辅助工具” -> "筛选组件"菜单项进入筛选组件列表页，点击“创建”按钮打开创建对话框，录入以上信息后完成创建。

点击对话框中的“校验”按钮，可对当前输入信息进行格式校验，如果校验成功则渲染出自定义组件演示框。

自定义筛选组件基础信息包括：组件名称、组件类型、组件配置等字段。

1、组件名称

+ 必要字段，可以使用中文、英文、数字以及各种字符，长度限制：5 ~ 25个字符之间。
+ 建议使用具有较高业务标识性的名称，便于组件共用。

2、组件类型

目前自定义组件只包含下拉框一种类型，同时支持一级和级联下拉框配置。

3、组件配置

注意：请使用标准JSON格式，非标准格式禁止录入，并且必须为数组结构。

+ 一级下拉框配置格式

```
[
    {
        "label": "北京",
        "value": "1"
    },
    {
        "label": "上海",
        "value": "2"
    },
    {
        "label": "河北",
        "value": "3"
    },
    {
        "label": "山东",
        "value": "4"
    }
]
```
+ 级联下拉框配置格式


```
[{
    "label": "北京",
    "value": "1",
    "children": [{
        "label": "东城区",
        "value": "11"
    }, {
        "label": "西城区",
        "value": "12"
    }]
}, {
    "label": "上海",
    "value": "2",
    "children": [{
        "label": "徐汇区",
        "value": "21"
    }, {
        "label": "宝山区",
        "value": "22"
    }]
}, {
    "label": "山东",
    "value": "3",
    "children": [{
        "label": "青岛",
        "value": "31"
    }, {
        "label": "济南",
        "value": "32"
    }]
}, {
    "label": "浙江",
    "value": "4",
    "children": [{
        "label": "杭州",
        "value": "41"
    }, {
        "label": "宁波",
        "value": "42"
    }]
}]
```

### 修改自定义筛选组件

筛选组件创建者在组件列表页选择相应组件，点击“修改”按钮，可对当前组件信息进行修改。

修改组件后，如果一些统计项正在依赖该组件则这些统计项的筛选信息会同步更新。

### 删除自定义筛选组件

筛选组件创建者在组件列表页选择相应组件，点击“删除”按钮可删除该组件。

删除组件时系统不会判断当前组件是否正被依赖，删除执行后依赖该组件的统计项将会恢复到默认设置，不建议对正被大量引用的组件。

## 筛选组件设置

统计项创建完成后系统默认使用系统内置下拉框进行展示，统计工程管理员可以在指标视图页面进行相应修改。

筛选组件修改功能支持重置，不用担心设置错误后会影响正常的指标查看，点击“重置”按钮可以一键回退到默认状态，而且该操作也不会影响指标正常计算，您可以放心操作。

### 切换内置筛选组件

内置筛选组件分为：内置下拉框和内置输入框。

如果需要互相切换，请按以下步骤操作：

+ 进入统计项视图页面，点击“筛选组件图表”打开筛选组件设置对话框；
+ 在对话框中的“当前配置”模块中，选择要替换维度的记录，并点击右侧“移除”按钮；
+ 在对话框上方的“系统组件”选项卡中，选择目标组件，并点击“添加”按钮，可将该组件添加到“当前配置”模块中；
+ 修改刚添加组件的纬度值和标签，其中纬度值为建立当前组件和统计项的某个维度的绑定关系，标签值是页面展示名称；
+ 点击确定进行保存；

注意：

“当前配置”模块中所有组件绑定的维度字段不可重复，并且需要覆盖当前统计项的所有维度字段。

### 引用自定义筛选组件

如果需要替换为自定义筛选组件，请按一下步骤操作：

+ 进入统计项视图页面，点击“筛选组件图表”打开筛选组件设置对话框；
+ 在对话框中的“当前配置”模块中，选择要替换维度的记录，并点击右侧“移除”按钮；
+ 在对话框上方的“自定义组件”选项卡中，选择目标组件，并点击“添加”按钮，可将该组件添加到“当前配置”模块中；
+ 修改刚添加组件的纬度值和标签，其中纬度值为建立当前组件和统计项的某个维度的绑定关系，标签值是页面展示名称（注意：当前配置中所有组件的绑定维度不可重复，并且需要覆盖当前统计项的所有维度字段）；
+ 点击确定进行保存；

注意：

“当前配置”模块中所有组件绑定的维度字段不可重复，并且需要覆盖当前统计项的所有维度字段。

如果要绑定自定义筛选组件为二级或多级级联，在创建统计项时必须包含级联的多个维度并保持顺序一致。

举例：
以下统计项需要绑定省份-城市级联筛选组件，则创建统计项是维度字段必须包含两个级联：province;city
```
<stat-item title="每10分钟_各城市_订单量" stat="count()" dimens="province;city" />
```


